# Подключение платежей (Tribute) к Telegram боту

Для приема платежей в боте мы используем нативную систему **Telegram Payments**. В качестве провайдера вы выбрали **Tribute** (Smart Glocal).

Вот пошаговая инструкция, как получить токен и подключить его к проекту.

## Шаг 1: Подготовка в Telegram

1. Откройте бота **[@BotFather](https://t.me/BotFather)** в Telegram.
2. Отправьте команду `/mybots` и выберите вашего бота из списка.
3. Нажмите кнопку **Payments**.
4. Выберите провайдера **Tribute** (или Smart Glocal / Sberbank - Tribute работает через них, обычно в списке он так и называется Tribute).
   * *Если Tribute нет в списке, выберите "Smart Glocal" (это юридическое лицо сервиса).*
5. Следуйте инструкциям бота для подключения (вас перекинет в бот Tribute для регистрации мерчанта).
   * Вам нужно будет создать проект в Tribute и пройти модерацию (обычно быстро).
   * После создания проекта в Tribute, вернитесь в @BotFather.
6. Когда подключение завершится, @BotFather выдаст вам **Payment Token** (Токен платежей).
   * Он выглядит примерно так: `12345678:TEST:123456...` (для теста) или `12345678:LIVE:123456...` (боевой).

## Шаг 2: Настройка проекта

1. Скопируйте полученный токен.
2. Откройте файл `bot/.env` в вашем проекте.
3. Добавьте (или обновите) переменную `PAYMENT_PROVIDER_TOKEN`:

```env
# ... другие настройки ...
PAYMENT_PROVIDER_TOKEN=ВАШ_ТОКЕН_ОТ_BOTFATHER
```

*Пример:*
`PAYMENT_PROVIDER_TOKEN=284685063:TEST:ZTVlYWQ2MzM3...`

## Шаг 3: Тестирование

Если вы используете **Тестовый токен** (TEST):
1. Перезапустите бота: `cd bot && bun run dev` (или через `start-all.sh`).
2. Зайдите в меню "Подписка" -> Выберите тариф.
3. Нажмите кнопку оплаты.
4. Telegram покажет тестовую форму карты. Введите данные тестовой карты (обычно Telegram сам предлагает их: `1111 1111 1111 1026`, 12/22, 000).
5. Если бот ответит "✅ Оплата прошла успешно!", значит все настроено верно.

## Шаг 4: Запуск в продакшн (LIVE)

1. Когда вы будете готовы принимать реальные деньги, вам нужно получить **LIVE** токен в @BotFather (для этого нужно пройти верификацию в Tribute).
2. Замените токен в `bot/.env` на боевой.
3. Перезапустите бота.

---

### Важные нюансы

* **Валюта:** В коде сейчас жестко прописано `RUB` (рубли). Если вы хотите принимать другую валюту, нужно изменить это в `bot/src/handlers/subscription.ts` (параметр currency в `sendInvoice`).
* **Цены:** Цены в коде указываются в **минимальных единицах** (копейках).
  * 159 ₽ = `15900`
  * 399 ₽ = `39900`
  * 999 ₽ = `99900`


